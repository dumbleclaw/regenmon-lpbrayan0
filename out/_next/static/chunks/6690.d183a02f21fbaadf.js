"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6690],{46690:function(e,t,n){n.r(t),n.d(t,{AwaitingExternalEthereumTransferScreen:function(){return M},default:function(){return M}});var a=n(57437),i=n(1442),r=n(2265),s=n(12629),o=n(35156),d=n(93715),c=n(87865),u=n(70751),l=n(78722),h=n(17283),f=n(39502),g=n(49227),m=n(60683),p=n(38992),v=n(97757),y=n(59287),b=n(20278),C=n(89660),I=n(71554),T=n(41884),w=n(75599),E=n(12485),S=n(96351),N=n(2230),x=n(65322),B=n(20166),A=n(80625),F=n(89297),$=n(27296),j=n(1473),k=n(74533),U=n(96821),_=n(22414);n(29155),n(97048),n(87336),n(64131),n(84250);let M={component:()=>{let{rpcConfig:e,appId:t,closePrivyModal:n,createAnalyticsEvent:M}=(0,I.u)(),{navigate:D,setModalData:P,data:H}=(0,w.a)(),W=(0,C.u)(),{wallets:q}=(0,S.u)(),[L,Q]=(0,r.useState)(!1),[R,O]=(0,r.useState)(0n),[V,Z]=(0,r.useState)(!1),[z,G]=(0,r.useState)(null),[K,Y]=(0,r.useState)(null),[J,X]=(0,r.useState)([]),[ee,et]=(0,r.useState)(0),[en,ea]=(0,r.useState)(!1),[ei,er]=(0,r.useState)(!1),[es,eo]=(0,r.useState)(!1),[ed,ec]=(0,r.useState)(!1),[eu,el]=(0,r.useState)(),[eh,ef]=(0,r.useState)();if(!H?.funding||"ethereum"!==H.funding.chainType)throw Error("Invalid funding data");let{erc20ContractInfo:eg,chain:em,connectedWallet:ep}=H.funding,ev=H.funding.address,ey=H.funding.erc20Address,[eb,eC]=(0,r.useState)(H.funding.amount);(0,r.useEffect)(()=>{ey&&!eg&&G(Error("Unable to fetch token details"))},[]);let eI=!!ey&&!!eg,eT=eI?BigInt(parseFloat(eb)*10**eg.decimals):(0,s.f)(eb),ew=("ethereum"===ep?.type?ep:void 0)??q[0],eE=(0,T.Q)(ew?.walletClientType||"unknown"),eS=eE?.name||"wallet",[eN,ex]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{if(!ew)return;let e=await ew.getEthereumProvider();ex((0,o.K)({account:ew.address,transport:(0,d.P)(e)}).extend(c.I))})().catch(console.error)},[ew]);let[eB,eA]=(0,r.useState)(0n);(0,r.useEffect)(()=>{(0,u.v)({chain:em,transport:(0,l.d)((0,U.a)(em,e,t))}).getBalance({address:ev}).then(eA).catch(console.error)},[]);let[eF,e$]=(0,r.useState)(0n);(0,r.useEffect)(()=>{eI&&(0,k.g)({chain:em,address:ev,appId:t,rpcConfig:e,erc20Address:ey}).then(e=>e$(e.balance)).catch(console.error)},[]);let{tokenPrice:ej}=(0,E.u)(em.id),[ek,eU]=(0,r.useState)({to:ev,chain:em,value:eT,data:void 0});(0,r.useEffect)(()=>{(async()=>{let n,a;if(!eN||!ew||en||es)return;ea(!0);let i=(0,u.v)({chain:ek.chain,transport:(0,l.d)((0,U.a)(ek.chain,e,t))});if(eI&&!ek.data)return await i.simulateContract({address:ey,chain:ek.chain,abi:N.E,functionName:"transfer",args:[ev,eT],account:ew.address}).catch(e=>{if("ContractFunctionZeroDataError"===e?.cause?.name||e?.message?.includes("returned no data"))return i.simulateContract({address:ey,chain:ek.chain,abi:N.a,functionName:"transfer",args:[ev,eT],account:ew.address}).catch(e=>{console.warn("Simulated token transfer failed with error, fetching bridge options.",e)});console.warn("Simulated token transfer failed with error, fetching bridge options.",e)})?(ea(!1),void eU({to:ey,chain:ek.chain,data:(0,h.R)({abi:N.E,functionName:"transfer",args:[ev,eT]}),value:"0x0"})):(ea(!1),void Z(!0));try{n=await i.prepareTransactionRequest({account:ew.address,to:ek.to,chain:ek.chain,data:ek.data,value:BigInt(ek.value??0)})}catch(e){if(console.error(e),J.length>1)Y(e.shortMessage??"Something went wrong");else if(ei&&0===J.length)return void G(new I.a(`Wallet ${(0,T.D)(ew.address)} does not have enough funds.`,void 0,I.b.INSUFFICIENT_BALANCE))}if(!n)return ea(!1),void Z(!0);ea(!1),eo(!0),Q(!0),O(n.gas);try{await eN.switchChain({id:ek.chain.id})}catch(e){await eN.addChain({chain:ek.chain}),await eN.switchChain({id:ek.chain.id})}try{a=await eN.sendTransaction(n)}catch(e){if(console.error(e),"TransactionExecutionError"===e.name){if(J.length<1){let t=e.shortMessage;(e.shortMessage.includes("rejected the request")||e.details.includes("rejected the request"))&&(t="User rejected the request."),G(new I.a(t,void 0,I.b.TRANSACTION_FAILURE))}else Y(e.shortMessage??"Something went wrong")}}if(a)return await eN.waitForTransactionReceipt({hash:a}),eo(!1),ei?(el(a),void ef("pending")):(ec(!0),P((0,$.y)(H,"completed",a,ew?.walletClientType,eI,eg,em)),void M({eventName:A.O,payload:{provider:"external",status:"success",txHash:a,address:ew.address,chainId:ek.chain.id,chainType:"ethereum",value:ek.value?(0,f.b)(BigInt(ek.value),eg?.decimals??18):void 0,token:eg?.symbol??ey??"ETH",destinationAddress:ev,destinationChainId:em.id,destinationChainType:"ethereum",destinationValue:eT?(0,f.b)(eT,eg?.decimals??18):void 0,destinationToken:eg?.symbol??ey??em.nativeCurrency.name}}));eo(!1)})().catch(console.error)},[eN,ek]),(0,r.useEffect)(()=>{(async()=>{if(!V||!eN||!ew)return;let n=(0,g.Q)(W.chains).filter(e=>e.id!==em.id&&!!e.testnet==!!em.testnet);eI&&n.unshift(em);let a=await (0,j.g)({chains:n,address:ew.address,appId:t,rpcConfig:e,includeUsdc:H.funding?.isUSDC}),i=eI?a.filter(e=>e.balance>0n):a.filter(e=>e.balance>eT),r=eI&&a.every(e=>0n===e.balance);if(i.length<1)return void G(new I.a(r?`Wallet ${(0,T.D)(ew.address)} doesn't have enough funds to cover gas fees. Top up your wallet and try again.`:`Wallet ${(0,T.D)(ew.address)} does not have enough funds.`,void 0,I.b.INSUFFICIENT_BALANCE));i.sort((e,t)=>Number(eI?(t.erc20Balance??0n)-(e.erc20Balance??0n):t.balance-e.balance));let s=i.flatMap(e=>{let n=[{...e,isErc20Quote:!1,isTestnet:!!em.testnet,input:(0,F.t)({appId:t,amount:eT.toString(),user:ew.address,recipient:ev,destinationChainId:em.id,destinationCurrency:ey,originChainId:e.chain.id})}];return eI&&ey&&(e.erc20Balance??0n)>=eT&&n.push({...e,isErc20Quote:!0,isTestnet:!!em.testnet,input:(0,F.t)({appId:t,amount:eT.toString(),user:ew.address,recipient:ev,destinationChainId:em.id,destinationCurrency:ey,originChainId:e.chain.id,originCurrency:e.erc20Address})}),n}),o=(await Promise.allSettled(s.map(async e=>({...e,quote:await (0,F.g)(e)})))).filter(e=>"fulfilled"===e.status).map(e=>e.value);if(o.length<1)return void G(new I.a(`Wallet ${(0,T.D)(ew.address)} does not have enough funds.`,void 0,I.b.INSUFFICIENT_BALANCE));let d=o.map(e=>({bridgeTx:(0,F.c)(e.quote),balance:e.balance,chain:e.chain,erc20Balance:e.erc20Balance,isErc20Quote:e.isErc20Quote})).filter(e=>!!e.bridgeTx);if(d.length>1)return void X(d);let c=d[0];c?(er(!0),eU({data:c.bridgeTx.data,to:c.bridgeTx.to,value:c.bridgeTx.value,chain:c.chain})):G(new I.a(`Wallet ${(0,T.D)(ew.address)} does not have enough funds.`,void 0,I.b.INSUFFICIENT_BALANCE))})().catch(console.error)},[V]),(0,F.u)({transactionHash:eu,isTestnet:!!em.testnet,bridgingStatus:eh,setBridgingStatus:ef,onSuccess({transactionHash:e}){er(!1),ec(!0),P((0,$.y)(H,"completed",e,ew?.walletClientType,eI,eg,em)),M({eventName:A.O,payload:{provider:"external",status:"success",txHash:e,address:ew?.address,chainId:ek.chain.id,chainType:"ethereum",value:ek.value?(0,f.b)(BigInt(ek.value),eg?.decimals??18):void 0,token:eg?.symbol??ey??"ETH",destinationAddress:ev,destinationChainId:em.id,destinationChainType:"ethereum",destinationValue:eT?(0,f.b)(eT,eg?.decimals??18):void 0,destinationToken:eg?.symbol??ey??em.nativeCurrency.name}})},onFailure({error:e}){er(!1),G(e)}}),(0,r.useEffect)(()=>{z&&(P({funding:H?.funding,solanaFundingData:H?.solanaFundingData,sendTransaction:H?.sendTransaction,errorModalData:{error:z,previousScreen:"TransferFromWalletScreen"}}),D("ErrorScreen",!1))},[z]);let e_=!eI&&ej?(0,B.c)(eb??"0",ej):void 0,eM=eI?R:(0,B.s)([R,eT]),eD=eM&&ej?(0,B.a)(eM,ej):void 0,eP=eM?(0,B.g)(eM,H?.funding?.erc20Address?H?.funding?.erc20ContractInfo?.symbol||"ETH":H?.funding?.chain.nativeCurrency.symbol||"ETH"):void 0,eH=R&&ej?(0,B.a)(R,ej):void 0,eW=R?(0,B.g)(R,em?.nativeCurrency?.symbol||"ETH"):void 0;if((0,r.useEffect)(()=>{if(!ed)return;let e=setTimeout(n,C.t);return()=>clearTimeout(e)},[ed]),ed)return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.t,{}),(0,a.jsx)(m.b,{}),(0,a.jsxs)(m.c,{children:[(0,a.jsx)(i.Z,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),(0,a.jsx)(v.C,{title:"Success!",description:`Youâ€™ve successfully added ${eb} ${eI?eg.symbol:em.nativeCurrency.symbol} to your ${W.name} wallet. It may take a minute before the funds are available to use.`})]}),(0,a.jsx)(m.R,{}),(0,a.jsx)(p.B,{})]});let eq=eI?`${(0,x.f)({amount:eF,decimals:eg.decimals})}  ${eg.symbol}`:(0,B.g)(eB,em.nativeCurrency.symbol,3,!0),eL=J[ee];return J.length>1&&eL?(0,a.jsx)(j.B,{displayName:eS,configuredFundingChain:em,erc20ContractInfo:eg,formattedBalance:eq,fundingAmount:eb,fundingCurrency:eI?eg.symbol:em.nativeCurrency.symbol,fundingAmountInUsd:e_,options:J,selectedOption:eL,isPreparing:en,isSubmitting:es,addressToFund:ev,fundingWalletAddress:ew?.address||"",errorMessage:K,onSubmit:()=>{H.funding?.amount!==eb?(async function(){if(ew&&eL)try{let e=await (0,F.g)({isTestnet:!!em.testnet,input:(0,F.t)({appId:t,amount:eT.toString(),user:ew.address,recipient:ev,destinationChainId:em.id,destinationCurrency:ey,originChainId:eL.chain.id})}),n=(0,F.c)(e);if(!n)throw Error("Invalid transaction request");er(!0),eU({data:n.data,to:n.to,value:n.value,chain:eL.chain})}catch(e){console.error(e),G(new I.a("Unable to fetch quotes for bridging",e,I.b.INSUFFICIENT_BALANCE))}})().catch(console.error):eU({to:eL.bridgeTx.to,data:eL.bridgeTx.data,value:eL.bridgeTx.value,chain:eL.chain})},onSelect:e=>{e!==ee&&(Y(null),et(e))},onAmountChange:eC}):L&&R&&ew&&H?.funding?(0,a.jsx)(_.T,{walletClientType:ew?.walletClientType||"unknown",displayName:eS,addressToFund:ev,isBridging:ei,isErc20Flow:eI,totalPriceInUsd:eD,totalPriceInNativeCurrency:eP,gasPriceInUsd:eH,gasPriceInNativeCurrency:eW,chainId:em.id,chainName:em.name}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.t,{}),(0,a.jsx)(b.N,{}),(0,a.jsx)("div",{style:{marginTop:"1rem"}}),(0,a.jsx)(p.B,{})]})}}},2230:function(e,t,n){n.d(t,{E:function(){return a},a:function(){return i}});let a=[{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"}],i=[{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}]},12629:function(e,t,n){n.d(t,{f:function(){return r}});var a=n(98173),i=n(57303);function r(e,t="wei"){return(0,i.v)(e,a.ez[t])}},57303:function(e,t,n){n.d(t,{v:function(){return r}});var a=n(81544);class i extends a.G{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function r(e,t){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new i({value:e});let[n,a="0"]=e.split("."),r=n.startsWith("-");if(r&&(n=n.slice(1)),a=a.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${a}`))&&(n=`${BigInt(n)+1n}`),a="";else if(a.length>t){let[e,i,r]=[a.slice(0,t-1),a.slice(t-1,t),a.slice(t)],s=Math.round(Number(`${i}.${r}`));(a=s>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${s}`).length>t&&(a=a.slice(1),n=`${BigInt(n)+1n}`),a=a.slice(0,t)}else a=a.padEnd(t,"0");return BigInt(`${r?"-":""}${n}${a}`)}}}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9281],{19281:function(e,t,s){s.r(t),s.d(t,{MfaAuthVerifyFlowScreen:function(){return c},default:function(){return c}});var r=s(57437),o=s(2265),a=s(89660),i=s(75599),n=s(87796);s(29155),s(97048),s(87336),s(64131),s(84250);let c={component:()=>{let{user:e}=(0,i.u)(),t=(0,a.u)(),s=(0,o.useMemo)(()=>e?.mfaMethods.filter(e=>"passkey"!==e||!t.globalDisablePasskeys)??[],[e?.mfaMethods,t.globalDisablePasskeys]),{data:c}=(0,i.a)(),[l,f]=(0,o.useState)(s[0]),[u,d]=(0,o.useState)(!1),[h,y]=(0,o.useState)(),[k,m]=(0,o.useState)();if((0,o.useEffect)(()=>{f(s[0])},[s]),!c?.mfaVerify)throw Error("Missing modal data for MFA verification screen.");let{onFailure:p,onSuccess:v,generateOptions:w,verifyTotpCode:g,verifyPasskey:S,verifySmsCode:b,sendSmsCode:M}=c.mfaVerify,C=async e=>{if("passkey"!==e)try{f(e),"sms"===e&&(f(e),await M()),"totp"===e&&f(e)}catch(e){console.error(e)}else try{f(e);let t=await w();if(!t)throw Error("something went wrong");y(t),await S(t),d(!0),m(void 0),v()}catch(e){m((0,n.t)(e))}},E=async e=>{m(void 0);try{if(!e||!l)return;if("passkey"===l){if(!h)throw Error("Missing passkey challenge");await S(h)}else"sms"===l?await b(e):"totp"===l&&await g(e);m(void 0),d(!0),v()}catch(e){throw(0,n.t)(e).error}},A=()=>{k||!u?p(k?.error??Error("Canceled MFA verification.")):v()},B=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{!B.current&&l&&(B.current=!0,C(l).finally(()=>{B.current=!1}))},[open]),e?"passkey"===l?(0,r.jsx)(n.V,{account:e.linkedAccounts.filter(e=>"passkey"===e.type&&e.enrolledInMfa).sort((e,t)=>t.firstVerifiedAt.valueOf()-e.firstVerifiedAt.valueOf())[0],submitSuccess:u,hasBlockingError:k?.isBlocking??!1,error:k?.error,onClose:A,onBack:()=>{f(void 0),m(void 0)},handleSubmit:()=>E(h).catch(m)}):"sms"===l||"totp"===l?(0,r.jsx)(n.a,{selectedMethod:l,submitSuccess:u,hasBlockingError:k?.isBlocking??!1,handleSubmitCode:E,onClose:A,onBack:s.length>1?()=>f(void 0):void 0}):(0,r.jsx)(n.b,{mfaMethods:s,onSelect:C,handleClose:A}):null}}}}]);
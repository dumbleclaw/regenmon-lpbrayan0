"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6849],{36849:function(e,n,t){t.r(n),t.d(n,{AwaitingEvmToSolBridgingScreen:function(){return B},default:function(){return B}});var a=t(57437),i=t(1442),r=t(2265),s=t(35156),o=t(93715),d=t(87865),u=t(70751),c=t(78722),l=t(39502),g=t(49227),f=t(60683),h=t(38992),m=t(97757),v=t(59287),p=t(20278),b=t(89660),S=t(71554),C=t(41884),T=t(75599),y=t(12485),w=t(96351),I=t(80625),E=t(89297),N=t(27296),x=t(57104),F=t(60164),A=t(1473),P=t(96821),U=t(22414);t(29155),t(97048),t(87336),t(64131),t(84250);let B={component:()=>{let e=(0,b.u)(),{rpcConfig:n,appId:t,closePrivyModal:B,createAnalyticsEvent:D}=(0,S.u)(),{navigate:k,setModalData:L,data:M}=(0,T.a)(),j=(0,b.u)(),{wallets:q}=(0,w.u)(),[H,Z]=(0,r.useState)(null),[R,V]=(0,r.useState)(null),[W,G]=(0,r.useState)([]),[J,$]=(0,r.useState)(0),[Q,Y]=(0,r.useState)(!1),[O,z]=(0,r.useState)(!1),[K,_]=(0,r.useState)(!1),[X,ee]=(0,r.useState)(!1),[en,et]=(0,r.useState)(),[ea,ei]=(0,r.useState)();if(!M?.funding||"solana"!==M.funding.chainType)throw Error("Invalid funding data");let{address:er,chain:es,connectedWallet:eo}=M.funding,[ed,eu]=(0,r.useState)(M.funding.amount),ec=("ethereum"===eo?.type?eo:void 0)??q[0],el=(0,C.Q)(ec?.walletClientType||"unknown"),eg=el?.name||"wallet",[ef,eh]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{if(!ec)return;let e=await ec.getEthereumProvider();eh((0,s.K)({account:ec.address,transport:(0,o.P)(e)}).extend(d.I))})().catch(console.error)},[ec]);let[em,ev]=(0,r.useState)(0n),ep=(0,F.g)(em);(0,r.useEffect)(()=>{let n=e.solanaRpcs[es];n?(0,N.x)({rpc:n.rpc,address:er}).then(e=>ev(BigInt(e))).catch(console.error):console.warn("Unable to load solana rpc, skipping balance")},[]);let[eb,eS]=(0,r.useState)(),{tokenPrice:eC}=(0,y.u)("solana"),{fundingAmountInBaseUnit:eT,fundingAmountInUsd:ey}=(0,F.a)({amount:ed,fee:0n,tokenPrice:eC,isUsdc:M.funding.isUSDC});if((0,r.useEffect)(()=>{(async()=>{if(!ef||!ec)return;let e=["solana:testnet","solana:devnet"].includes(es);e&&console.warn("Solana testnets are not supported for bridging");let a=(0,g.Q)(j.chains).filter(({testnet:n})=>!!n===e),i=(await (0,A.g)({chains:a,address:ec.address,appId:t,rpcConfig:n})).filter(e=>e.balance>0n);if(i.length<1)return void Z(new S.a(`Wallet ${(0,C.D)(ec.address)} does not have enough funds.`,void 0,S.b.INSUFFICIENT_BALANCE));i.sort((e,n)=>Number(n.balance-e.balance));let r=(await Promise.allSettled(i.map(async e=>({...e,quote:await (0,E.g)({isTestnet:!1,input:(0,E.t)({appId:t,amount:eT.toString(),user:ec.address,recipient:er,destinationChainId:E.b,destinationCurrency:E.a,originChainId:e.chain.id})})})))).filter(e=>"fulfilled"===e.status).map(e=>e.value);if(r.length<1)return void Z(new S.a(`Unable to fetch quotes for bridging. Wallet ${(0,C.D)(ec.address)} does not have enough funds.`,void 0,S.b.INSUFFICIENT_BALANCE));let s=r.map(({quote:e,balance:n,chain:t})=>({bridgeTx:(0,E.c)(e),balance:n,chain:t,isErc20Quote:!1})).filter(({bridgeTx:e})=>!!e);if(s.length>1)return void G(s);let o=s.at(0);o?(z(!0),eS({data:o.bridgeTx.data,to:o.bridgeTx.to,value:o.bridgeTx.value,chain:o.chain})):Z(new S.a(`Unable to select bridge option from quotes. Wallet ${(0,C.D)(ec.address)} does not have enough funds.`,void 0,S.b.INSUFFICIENT_BALANCE))})().catch(console.error)},[ef]),(0,r.useEffect)(()=>{(async()=>{let e,a;if(!ef||!ec||Q||K||!eb)return;Y(!0);let i=(0,u.v)({chain:eb.chain,transport:(0,c.d)((0,P.a)(eb.chain,n,t))});try{e=await i.prepareTransactionRequest({account:ec.address,to:eb.to,chain:eb.chain,data:eb.data,value:BigInt(eb.value??0)})}catch(e){console.error(e),W.length>1&&V(e.shortMessage??"Something went wrong")}if(e){Y(!1),_(!0);try{await ef.switchChain({id:eb.chain.id})}catch(e){await ef.addChain({chain:eb.chain}),await ef.switchChain({id:eb.chain.id})}try{a=await ef.sendTransaction(e)}catch(e){console.error(e),"TransactionExecutionError"===e.name&&(W.length<1?Z(new S.a(e.shortMessage,void 0,S.b.TRANSACTION_FAILURE)):V(e.shortMessage??"Something went wrong"))}if(a)return await ef.waitForTransactionReceipt({hash:a}),O?(ei("pending"),void et(a)):(_(!1),ee(!0),void D({eventName:I.O,payload:{provider:"external",status:"success",txHash:a,address:ec.address,chainId:eb.chain.id,chainType:"ethereum",value:eb.value?(0,l.b)(BigInt(eb.value),18):void 0,token:"ETH",destination:er,destinationClusterName:"mainnet-beta",destinationChainType:"solana",destinationValue:(0,l.b)(eT,9),destinationToken:"SOL"}}));_(!1)}else Y(!1)})().catch(console.error)},[ef,eb]),(0,E.u)({transactionHash:en,isTestnet:!1,bridgingStatus:ea,setBridgingStatus:ei,onSuccess({transactionHash:e}){z(!1),ee(!0),D({eventName:I.O,payload:{provider:"external",status:"success",txHash:e,address:ec?.address,chainId:eb?.chain.id,chainType:"ethereum",value:eb?.value?(0,l.b)(BigInt(eb.value),18):void 0,token:"ETH",destination:er,destinationClusterName:"mainnet-beta",destinationChainType:"solana",destinationValue:(0,l.b)(eT,9),destinationToken:"SOL"}})},onFailure({error:e}){z(!1),Z(e)}}),(0,r.useEffect)(()=>{H&&(L({funding:M?.funding,solanaFundingData:M?.solanaFundingData,sendTransaction:M?.sendTransaction,errorModalData:{error:H,previousScreen:"TransferFromWalletScreen"}}),k("ErrorScreen",!1))},[H]),(0,r.useEffect)(()=>{if(!X)return;let e=setTimeout(B,b.t);return()=>clearTimeout(e)},[X]),X)return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.t,{}),(0,a.jsx)(f.b,{}),(0,a.jsxs)(f.c,{children:[(0,a.jsx)(i.Z,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),(0,a.jsx)(m.C,{title:"Success!",description:`Youâ€™ve successfully added ${ed} SOL to your ${j.name} wallet. It may take a minute before the funds are available to use.`})]}),(0,a.jsx)(f.R,{}),(0,a.jsx)(h.B,{})]});let ew=W[J];return W.length>1&&ew?(0,a.jsx)(A.B,{displayName:eg,configuredFundingChain:es,formattedBalance:ep,fundingAmount:ed,fundingCurrency:"SOL",fundingAmountInUsd:ey,options:W,selectedOption:ew,isPreparing:Q,isSubmitting:K,addressToFund:er,fundingWalletAddress:ec?.address||"",errorMessage:R,onSubmit:()=>{M.funding?.amount!==ed?(async function(){if(ec&&ew)try{let e=await (0,E.g)({isTestnet:!1,input:(0,E.t)({appId:t,amount:eT.toString(),user:ec.address,recipient:er,destinationChainId:E.b,destinationCurrency:E.a,originChainId:ew.chain.id})}),n=(0,E.c)(e);if(!n)throw Error("Invalid transaction request");z(!0),eS({data:n.data,to:n.to,value:n.value,chain:ew.chain})}catch(e){console.error(e),Z(new S.a("Unable to fetch quotes for bridging",e,S.b.INSUFFICIENT_BALANCE))}})().catch(console.error):eS({to:ew.bridgeTx.to,data:ew.bridgeTx.data,value:ew.bridgeTx.value,chain:ew.chain})},onSelect:e=>{e!==J&&(V(null),$(e))},onAmountChange:eu}):K&&ec?(0,a.jsx)(U.T,{walletClientType:ec?.walletClientType||"unknown",displayName:eg,addressToFund:er,isBridging:O,isErc20Flow:!1,chainId:"solana",chainName:(0,x.g)(es),totalPriceInUsd:void 0,totalPriceInNativeCurrency:void 0,gasPriceInUsd:void 0,gasPriceInNativeCurrency:void 0}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.t,{}),(0,a.jsx)(p.N,{}),(0,a.jsx)("div",{style:{marginTop:"1rem"}}),(0,a.jsx)(h.B,{})]})}}},36672:function(e,n,t){t.d(n,{A:function(){return o},D:function(){return c},J:function(){return u},L:function(){return a},R:function(){return d},S:function(){return i},T:function(){return r},a:function(){return s},g:function(){return l}});let a=1e9,i="11111111111111111111111111111111",r="TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",s="TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb",o="ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",d=["CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C","CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"],u=["JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4"],c={"solana:mainnet":{EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v:{symbol:"USDC",decimals:6,address:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"},Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB:{symbol:"USDT",decimals:6,address:"Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"},So11111111111111111111111111111111111111112:{symbol:"SOL",decimals:9,address:"So11111111111111111111111111111111111111112"}},"solana:devnet":{"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU":{symbol:"USDC",decimals:6,address:"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU"},EJwZgeZrdC8TXTQbQBoL6bfuAnFUUy1PVCMB4DYPzVaS:{symbol:"USDT",decimals:6,address:"EJwZgeZrdC8TXTQbQBoL6bfuAnFUUy1PVCMB4DYPzVaS"},So11111111111111111111111111111111111111112:{symbol:"SOL",decimals:9,address:"So11111111111111111111111111111111111111112"}},"solana:testnet":{}};function l(e,n){let t=parseFloat(e.toString())/a,i=g.format(n*t);return"$0.00"===i?"<$0.01":i}let g=new Intl.NumberFormat(void 0,{style:"currency",currency:"USD",maximumFractionDigits:2})},60164:function(e,n,t){t.d(n,{a:function(){return r},g:function(){return i}});var a=t(36672);function i(e,n=6,t=!1,a=!1){let i=(parseFloat(e.toString())/1e9).toFixed(n).replace(/0+$/,"").replace(/\.$/,""),r=a?"":" SOL";return t?`${i}${r}`:`${"0"===i?"<0.001":i}${r}`}function r({amount:e,fee:n,tokenPrice:t,isUsdc:r}){let s=BigInt(Math.floor(parseFloat(e)*10**(r?6:9))),o=r?s:s+n;return{fundingAmountInBaseUnit:s,fundingAmountInUsd:t?(0,a.g)(s,t):void 0,totalPriceInUsd:t?(0,a.g)(o,t):void 0,totalPriceInNativeCurrency:i(o),feePriceInNativeCurrency:i(n),feePriceInUsd:t?(0,a.g)(n,t):void 0}}}}]);